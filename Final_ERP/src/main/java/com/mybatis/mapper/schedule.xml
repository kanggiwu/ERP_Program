<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper
 PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
 "http://mybatis.org/dtd/mybatis-3-mapper.dtd"> 
<mapper namespace="com.mybatis.mapper.">
	
	<!-- 처음 화면에 들어왔을 때의 현재 월의 일정 가져오기 -->
	<select id="getAttendanceThisMonth" parameterType="int" resultType="map">
		 SELECT attendance_code, emp_no, attendance_start_work
  		   FROM attendance
		  WHERE emp_no = 1/* #{emp_no} */
    		AND attendance_start_work BETWEEN TRUNC(SYSDATE+1)-TO_CHAR(SYSDATE,'DD') AND TRUNC(LAST_DAY(SYSDATE))+0.99999421
	</select>
	
	<!-- 사용자가 선택한 월의 일정 리스트 가져오기 -->
	<select id="getAttendanceOptional" parameterType="string" resultType="map">
		    SELECT attendance_code, emp_no, attendance_start_work
  			  FROM attendance
 			 WHERE     emp_no = 5
       			AND TO_DATE (SUBSTR (attendance_start_work, 1, 10), 'YYYY/MM/DD') 
             	BETWEEN   TRUNC (TO_DATE(#{해당월의 날짜스트링})  + 1) - TO_CHAR (TO_DATE(#{해당월의 날짜스트링}), 'DD')
             	AND TRUNC ( LAST_DAY (#{해당월의 날짜스트링}) + 0.99999421
	</select>

	<!-- 일정 조회  1:공통 2:인사부 3:회계부 4:개발부 5:프로젝트 6개인 -->
	<select id="getScheduleList" parameterType="int" resultType="map">
		SELECT schedule_code, emp_no, schedule_type, schedule_title, schedule_startdate, schedule_enddate, schedule_content
 		  FROM schedule
		 WHERE schedule_type = #{schedule_type}
	</select>
	
	<!-- 스케쥴 정보 입력 -->
	<insert id="insertSchedule" parameterType="map">
		INSERT INTO schedule (schedule_code, emp_no, schedule_type, schedule_title, schedule_startdate, schedule_enddate, schedule_content)
        	 VALUES (#{schedule_code}, #{emp_no}, #{schedule_type}, #{schedule_title} , #{schedule_startdate}, #{schedule_enddate}, #{schedule_content})
	</insert>
	
	
<!-- ////////////////////////////////// 일정 수정 페이지/////////////////////////////////////////////////// -->

	<!-- 일정의 작성자가 맞는지 확인하기 위해 일정작성시 저장된 사원번호 불러오기 -->
	<select id="getScheduleWriter" parameterType="int" resultType="int">
		SELECT emp_no FROM schedule WHERE schedule_code = #{schedule_code};
	</select>
	
	<!-- 일정 수정 -->
	<update id="getBmNo" parameterType="map">
		UPDATE schedule
		SET 
    		emp_no = #{emp_no},
    		schedule_type = #{schedule_type},
    		schedule_title = #{schedule_title},
   			schedule_startdate = #{schedule_startdate},
			schedule_enddate = #{schedule_enddate},
		    schedule_content = #{schedule_content}
		WHERE  schedule_code = #{schedule_code};
	</update>
<!-- /////////////////////////////////////////////////////////////////////////////////////////////////// -->

	<!-- 일정 삭제 -->
	<delete id="deleteSchedule" parameterType="int">
		DELETE schedule WHERE schedule_code = #{schedule_code};
	</delete>

</mapper>